/*! jquery-simpletable - v0.0.1 - 2014-04-21
* https://github.com/edgardleal/jquery-simpletable
* Copyright (c) 2014 Edgard Leal; Licensed MIT */
var __x=eval;!function(a){a.widget("custom.simpleTable",{options:{keyField:null,data:void 0,url:void 0,editable:!1,postAsForm:!0,columns:[],table:null,border:1},setStyle:function(){a(".jtable th").each(function(){a(this).addClass("ui-state-default")}),a(".jtable td").each(function(){a(this).addClass("ui-widget-content")})},_setupHead:function(){var b=this,c='<thead><tr class="ui-widget-header">';for(var d in b.options.columns)c+='<th clas="ui-state-default" width="'+b.options.columns[d].width+'">'+b.options.columns[d].title+"</th>";b.element.prepend(a(c+"</tr>"))},_setupBody:function(){var a="<tbody></tbody>";return this.body=this.element.append(a),this.bory},_findColumn:function(a){for(var b in this.options.columns)if(this.options.columns[b].title===a)return this.options.columns[b]},_serializeRow:function(b){var c=this,d=/%20/g,e="{",f=[],g=b.find("td");if(c.options.postAsForm)return g.each(function(b,c){var d=a(c),e=d.find("input select textarea keygen");f[f.length]=e.length?encodeURIComponent(e.attr("name")+"="+encodeURIComponent(e.val())):encodeURIComponent(d.attr("name"))+"="+encodeURIComponent(d.text())}),f.push("_id="+encodeURIComponent(b.attr("id"))),f.join("&").replace(d,"+");for(var h in c.options.columns)e+=("{"===e?"":",")+'"'+c.options.columns[h].field+'":"'+g.get(h).innerText+'"';return e=e+("{"===e?"":",")+'"_id" : "'+b.attr("id")+'"',e+"}"},save:function(b){var c=this;c.options.url&&a.ajax({type:"POST",dataType:"json",url:c.options.url,data:c._serializeRow(b)})},_createRow:function(b,c){var d=this,e='<tr id="'+c+'">',f=d.options.editable?'contenteditable="true"':"";d._each(b,function(a,b){e+='<td name="'+b.field+'" '+f+' class="ui-widget-content"></td>'});var g=a(e+"</tr>");return d.body.append(g),g.hover(function(){a(this).children("td").addClass("ui-state-hover")},function(){a(this).children("td").removeClass("ui-state-hover")}).click(function(){a(this).children("td").toggleClass("ui-state-highlight")}),d.options.editable&&g.find("td").blur(function(){g.modified=!0,d.options.autosave&&d.save(g)}),g},checkCondition:function(a,b){var c='var value="'+a+'"\n';c+=b;try{return __x(c)}catch(d){}},_buildCellHtml:function(a,b,c,d){var e=a[b.field];return b.mapFunction&&"function"==typeof b.mapFunction&&(e=b.mapFunction.call(this,a,b,c,d)),e},_refreshRow:function(a){var b=this,c=a[b.options.keyField];if(!c)throw"keyField not pased";var d=b.body.find("tr[id="+c+"]");(!d||d.length<1)&&(d=b._createRow(b.options.columns,c));var e=0,f=d.find("td");for(var g in b.options.columns){var h=b.options.columns[g];if(h){var i=a[h.field],j='var value="'+i+'"\n',k=f.get(e++);if(h.conditions)for(var l in h.conditions)try{if(__x(j+h.conditions[l].expression)){var m=h.conditions[l].cell,n=h.conditions[l].parent;m&&(k.style.cssText=m),n&&(d.get(0).style.cssText=n);break}}catch(o){}k.innerHTML=b._buildCellHtml(a,h,d,k)}}},refreshremote:function(b,c){var d=this,e=b?b:d.options.url;return e?void a.get(e).success(function(a){for(var b in a)d._refreshRow(a[b]);c&&"function"==typeof c&&c.call(d,a)}):this},refresh:function(){var a=this;if(a.options.url)a.refreshremote();else for(var b in a.options.data)a._refreshRow(a.options.data[b])},_each:function(a,b,c){for(var d in a)b.call(this,d,a[d]);c&&"function"==typeof c&&c.call(this)},_create:function(){var a=this;a.head=a.element.find("thead"),a.head.length||a._setupHead(),a.body=a.element.find("tbody"),a.body.length||a._setupBody();for(var b in a.options.columns)a.options.columns[b].field||(a.options.columns[b].field=a.options.columns[b].title);a.element.addClass("ui-widget").attr("border",a.options.border),this.refresh()}}),a.expr[":"].simpletable=function(b){return a(b).hasClass("simpletable")}}(jQuery);